# PFS Server Configuration File

server:
  address: ":8080"
  log_level: info # Options: debug, info, warn, error

# ============================================================================
# Plugin Configurations
# ============================================================================
# Plugins can be defined as:
# 1. Single instance: { enabled, path, config }
# 2. Multiple instances: array of { name, enabled, path, config }

plugins:
  serverinfofs:
    enabled: true
    path: /serverinfofs
    config:
      version: "1.0.0"

  memfs:
    enabled: true
    path: /memfs
    config:
      init_dirs:
        - /home
        - /tmp

  queuefs:
    enabled: true
    path: /queuefs
    config: {}

  kvfs:
    enabled: true
    path: /kvfs
    config:
      initial_data:
        welcome: "Hello from VFS Server!"
        version: "1.0.0"

  hellofs:
    enabled: true
    path: /hellofs

  streamfs:
    enabled: true
    path: /streamfs

  # ============================================================================
  # LocalFS - Local File System Mount
  # ============================================================================
  localfs:
    enabled: true
    path: /local/tmp
    config:
      local_dir: /tmp # Path to the local directory to mount

  # Example: Multiple local mounts (uncomment to use)
  # localfs_home:
  #   enabled: false
  #   path: /home
  #   config:
  #     local_dir: /Users/username  # Mount home directory

  # localfs_data:
  #   enabled: false
  #   path: /data
  #   config:
  #     local_dir: /var/data  # Mount data directory

  # ============================================================================
  # SQLFS - Database-backed File System (Multiple Instances)
  # ============================================================================
  sqlfs:
    # SQLite instance for local development
    - name: local
      enabled: true
      path: /sqlfs
      config:
        backend: sqlite
        db_path: sqlfs.db
        cache_enabled: true
        cache_max_size: 1000
        cache_ttl_seconds: 5

    # TiDB instance for production (disabled by default)
    - name: tidb
      enabled: true
      path: /sqlfs_tidb
      config:
        backend: tidb
        dsn: "<username>:<password>@tcp(addr)/<dbname>?charset=utf8mb4&parseTime=True&tls=tidb"
        cache_enabled: true
        cache_max_size: 1000
        cache_ttl_seconds: 5

  sqlfs2:
    enabled: true
    path: "/sqlfs2/tidb"
    config:
      backend: "tidb"
      dsn: "<username>:<password>@tcp(addr)/<dbname>?charset=utf8mb4&parseTime=True&tls=tidb"


  # ============================================================================
  # ProxyFS - Remote PFS Proxy (Multiple Instances)
  # ============================================================================
  proxyfs:
    # Remote server 1 (disabled by default)
    - name: remote1
      enabled: false
      path: /proxyfs/remote1
      config:
        base_url: "http://localhost:9090/api/v1"

    # Remote server 2 (disabled by default)
    - name: remote2
      enabled: false
      path: /proxyfs/remote2
      config:
        base_url: "http://another-server:8080/api/v1"

  s3fs:
    - name: aws
      enabled: true
      path: /s3fs/aws
      config:
        region: us-west-1
        bucket: bucket-name
        access_key_id: key_id
        secret_access_key: secret
        prefix: pfs/ # Optional: all keys will be prefixed with "pfs/"

  # ============================================================================
  # HTTPFS - HTTP File Server (Multiple Instances)
  # ============================================================================
  # HTTPFS serves PFS paths over HTTP, similar to 'python3 -m http.server'.
  # Each instance can serve a different PFS path on a different port.
  #
  # Features:
  # - Serve any PFS filesystem (memfs, queuefs, s3fs, etc.) via HTTP
  # - Browse directories and download files in web browser
  # - README files display inline instead of downloading
  # - Virtual status file: 'pfs cat /httpfs-memfs' shows instance info
  # - Dynamic mounting: 'pfs mount httpfs /path pfs_path=/memfs http_port=9000'
  #
  httpfs:
    # Instance 1: Serve memfs on port 9000
    - name: httpfs-memfs
      enabled: true
      path: /httpfs-memfs
      config:
        pfs_path: /memfs        # The PFS path to serve
        port: "9000"       # HTTP server port

    # Instance 2: Serve queuefs on port 9001 (disabled by default)
    - name: httpfs-queue
      enabled: false
      path: /httpfs-queue
      config:
        pfs_path: /queuefs
        port: "9001"

    # Instance 3: Serve S3 content on port 9002 (disabled by default)
    - name: httpfs-s3
      enabled: false
      path: /httpfs-s3
      config:
        pfs_path: /s3fs/aws
        port: "9002"
        host: "localhost"

  # Example: Single instance httpfs (uncomment to use)
  # httpfs_public:
  #   enabled: false
  #   path: /httpfs-public
  #   config:
  #     pfs_path: /memfs/public  # Serve only public directory
  #     http_port: "8000"        # Default port

  # Note: You can also mount httpfs dynamically at runtime:
  #   pfs mount httpfs /httpfs-temp pfs_path=/memfs http_port=10000
  #   pfs cat /httpfs-temp        # View instance status
  #   pfs unmount /httpfs-temp    # Remove when done

# ============================================================================
# File System Structure
# ============================================================================
# With current enabled plugins:
# /
# ├── serverinfofs/   (server information)
# ├── memfs/          (in-memory filesystem)
# ├── queuefs/        (message queue)
# ├── kvfs/           (key-value store)
# ├── hellofs/        (hello world plugin)
# ├── streamfs/       (streaming data)
# ├── sqlfs/          (database-backed filesystem - SQLite)
# ├── httpfs-memfs    (virtual status file for httpfs instance)
# └── local/
#     └── tmp/        (local file system mount)
#
# If additional instances are enabled:
# ├── sqlfs_tidb/     (database-backed filesystem - TiDB)
# ├── httpfs-queue    (virtual status file - httpfs serving queuefs)
# ├── httpfs-s3       (virtual status file - httpfs serving S3)
# ├── s3fs/
# │   └── aws/        (AWS S3 storage)
# └── proxyfs/
#     ├── remote1/    (remote PFS server 1)
#     └── remote2/    (remote PFS server 2)
#
# HTTPFS instances are also accessible via HTTP:
# - http://localhost:9000/  -> serves /memfs
# - http://localhost:9001/  -> serves /queuefs (if enabled)
# - http://localhost:9002/  -> serves /s3fs/aws (if enabled)

# ============================================================================
# Usage Examples
# ============================================================================
#
# Access local plugins:
#   pfs ls /memfs
#   pfs cat /streamfs/video
#   pfs write /sqlfs/data/config.txt "data"
#
# Access local file system (when enabled):
#   pfs ls /local
#   pfs cat /local/file.txt
#   pfs write /local/newfile.txt "content"
#
# Access remote endpoints (when enabled):
#   pfs ls /proxyfs/remote1
#   pfs cat /proxyfs/remote1/hello.txt
#
# Access S3 storage (when enabled):
#   pfs ls /s3fs/aws
#   pfs write /s3fs/aws/data.txt "cloud data"
#
# Multiple SQLFS instances (when enabled):
#   pfs write /sqlfs/local-data.txt "local"
#   pfs write /sqlfs_tidb/prod-data.txt "production"
#
# HTTPFS - HTTP File Server:
#   # View httpfs instance status
#   pfs cat /httpfs-memfs
#
#   # Access via HTTP (browser or curl)
#   curl http://localhost:9000/              # List directory
#   curl http://localhost:9000/file.txt      # Download file
#   # Or open in browser: http://localhost:9000/
#
#   # Dynamic mounting (create temporary HTTP servers)
#   pfs mount httpfs /temp-http pfs_path=/memfs http_port=10000
#   pfs cat /temp-http                       # Check status
#   # Now accessible at http://localhost:10000/
#   pfs unmount /temp-http                   # Remove when done
#
#   # Multiple instances serving different content
#   pfs mount httpfs /docs pfs_path=/memfs/docs http_port=8001
#   pfs mount httpfs /images pfs_path=/memfs/images http_port=8002
#   pfs mount httpfs /s3-public pfs_path=/s3fs/aws/public http_port=8003
